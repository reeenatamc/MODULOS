<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Artistas</title>
    <link rel="stylesheet" href="usuario.css">
</head>
<body>
    <header>
        <h1>
            <a href="../index.html" class="title">SISTEMA DE ARTISTAS</a>
        </h1>
        <nav>
            <a href="usuario.html" class="role">Usurios</a>
        </nav>
    </header>
    
    <section class="crud-section">
        <h2>Gestión de Usuarios (CRUD)</h2>
        <form id="userForm">
            <label for="id_usuario">ID Usuario</label>
            <input type="number" id="id_usuario" placeholder="Ingrese ID de usuario" required>
            
            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" placeholder="Ingrese el nombre" required>
            
            <label for="apellido">Apellido</label>
            <input type="text" id="apellido" placeholder="Ingrese el apellido" required>
            
            <label for="email">Correo Electrónico</label>
            <input type="email" id="email" placeholder="Ingrese el correo electrónico" required>
            
            <label for="contrasena">Contraseña</label>
            <input type="password" id="contrasena" placeholder="Ingrese la contraseña" required>
            
            <label for="fecha_creacion">Fecha de Creación</label>
            <input type="text" id="fecha_creacion" placeholder="Ingrese la fecha de creación" disabled>

            <div class="buttons">
                <button type="button" class="btn btn-create">Crear</button>
                <button type="button" class="btn btn-read">Verificar</button>
                <button type="button" class="btn btn-update">Actualizar</button>
                <button type="button" class="btn btn-delete">Eliminar</button>
            </div>
        </form>
    </section>

    <script>
        const API_URL = 'http://localhost:3000/api/usuarios';

        // Función para manejar errores de la API
        const handleApiError = (error) => {
            console.error('Error:', error);
            alert('Error: ' + (error.message || 'Error desconocido'));
        };

        // Función para obtener los valores del formulario
        const getFormValues = () => {
            return {
                id_usuario: document.getElementById('id_usuario').value,
                nombre: document.getElementById('nombre').value,
                apellido: document.getElementById('apellido').value,
                email: document.getElementById('email').value,
                contrasena: document.getElementById('contrasena').value,
                fecha_creacion: document.getElementById('fecha_creacion').value
            };
        };

        // Función para limpiar el formulario
        const clearForm = () => {
            document.getElementById('userForm').reset();
        };

        // Función para crear un usuario
        document.querySelector('.btn-create').addEventListener('click', async function() {
            try {
                const userData = getFormValues();
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                const data = await response.json();
                alert('Usuario creado: ' + data.id_usuario);
                clearForm();
            } catch (error) {
                handleApiError(error);
            }
        });

        // Función para verificar un usuario
        document.querySelector('.btn-read').addEventListener('click', async function() {
            try {
                const userId = document.getElementById('id_usuario').value;
                const response = await fetch(`${API_URL}/${userId}`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('nombre').value = data.nombre;
                    document.getElementById('apellido').value = data.apellido;
                    document.getElementById('email').value = data.email;
                    document.getElementById('contrasena').value = data.contrasena;
                    document.getElementById('fecha_creacion').value = data.fecha_creacion;
                } else {
                    alert('Usuario no encontrado');
                }
            } catch (error) {
                handleApiError(error);
            }
        });

        // Función para actualizar un usuario
        document.querySelector('.btn-update').addEventListener('click', async function() {
            try {
                const userId = document.getElementById('id_usuario').value;
                const userData = getFormValues();
                const response = await fetch(`${API_URL}/${userId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                const data = await response.json();
                alert('Usuario actualizado: ' + data.id_usuario);
                clearForm();
            } catch (error) {
                handleApiError(error);
            }
        });

        // Función para eliminar un usuario
        document.querySelector('.btn-delete').addEventListener('click', async function() {
            try {
                const userId = document.getElementById('id_usuario').value;
                const response = await fetch(`${API_URL}/${userId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Usuario eliminado');
                    clearForm();
                } else {
                    alert('Error al eliminar el usuario');
                }
            } catch (error) {
                handleApiError(error);
            }
        });
    </script>
</body>
</html>
